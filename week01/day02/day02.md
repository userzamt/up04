# День 02. Работа с пользователями

# WinSCP 
**WinSCP** — свободный графический клиент протоколов SFTP и SCP, предназначенный для Windows. Распространяется по лицензии GNU GPL. Обеспечивает защищённое копирование файлов между компьютером и серверами, поддерживающими эти протоколы.

[Скачать WinSCP](https://winscp.net/eng/download.php)


# PuTTY  
**PuTTY** — свободно распространяемый клиент для различных протоколов удалённого доступа, включая SSH, Telnet, rlogin. Также имеется возможность работы через последовательный порт.

[Скачать PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)


## TightVNC 
**TightVNC** — кроссплатформенная свободная программа, реализация VNC с расширениями для оптимизации работы в условиях медленных каналов передачи данных. Позволяет обращаться дистанционно к рабочему столу другого компьютера через клиентскую программу или браузер, используя встроенный веб-сервер. 

**Virtual Network Computing** (VNC) — система удалённого доступа к рабочему столу компьютера, использующая протокол RFB (англ. Remote FrameBuffer, удалённый кадровый буфер). Управление осуществляется путём передачи нажатий клавиш на клавиатуре и движений мыши с одного компьютера на другой и ретрансляции содержимого экрана через компьютерную сеть.

[Настройка x11vnc на виртуальной машине](https://redos.red-soft.ru/base/server-configuring/remote-control/x11vnc/)

[Vnc-клиент TightVNC](https://www.tightvnc.com/download.php)


## Пользователи
РЕД ОС, как и любой UNIX – многопользовательская операционная система. Также имеются группы пользователей, основное предназначение которых - облегчить управление большим количеством пользователей, а также более точно распределить права доступа к различным объектам системы. Пользователи и группы внутри системы обозначаются цифровыми идентификаторами - UID и GID, соответственно.

Пользователь может входить в одну или несколько групп. По умолчанию он входит в группу, совпадающую с его именем. Чтобы узнать, в какие еще группы входит пользователь, введите команду id, вывод ее может быть примерно следующим:

```bash
id 
# uid=1000(user) gid=1000(user) группы=1000(user),10(wheel)
```

Информация о пользователях хранится в следующих файлах:
+ `/etc/passwd` -  Хотя название этого файла и напоминает слово пароль, тем не менее, пароли там не хранятся. В нем хранятся атрибуты пользователя, разделенные знаком `:`. Первый столбец - логин, второй - х (ранее там находился пароль), UID, GID, комментарий, домашний каталог пользователя, оболочка.

+ `/etc/group` - В этом файле хранится информация о группах и пользователях, которые входят в эти группы. Формат файла аналогичен предыдущему - имя группы, пароль (теперь в другом файле и вообще крайне редко используется), gid, пользователи, входящие в эту группу.

+ `/etc/shadow` - В этом файле хранятся пароли в зашифрованном виде. Данные в файле также разделены - имя пользователя, зашифрованный пароль, дата последнего изменения, минимальное число дней между изменениями пароля, максимальное время жизни пароля, количество дней до истечения срока действия пароля, количество дней после истечения срока действия пароля (после которого учетная запись будет отключена), срок действия учетной записи.

Действия над пользователями:
1. **создание** Создавать пользователей можно командами `useradd` (создает пользователя и просит задать пароль) и `adduser` (при создании можно указать множество атрибутов). Наиболее часто используемые атрибуты при создании пользователя - комментарий (стоит все-таки использовать, если у вас не 1-2 пользователя в системе), домашняя директория (если не указать, то будет /home), оболочка, разрешено ли заходить в систему.
1. **задание пароля** Задать (или же изменить) пароль можно командой `passwd`

1. **изменение параметров пользователя** После создания все эти параметры можно изменить командой `usermod`


### passwd 
| Опция	| Значение опции |
|:-----:|:---------------|
| -d,- -delete | Удалить пароль для указанной записи |
| --stdin | Прочитать новые пароли из стандартного ввода|


### useradd
```bash
groupadd clietns

adduser \
   --shell /bin/bash \
   --comment 'Alexander Duggan' \
   --gid clietns \
   --home-dir /home/duggan \
   --create-home \
   client1

passwd client1
```


## Практическое задание
>[!CAUTION]
> Все проделанные Вами действия должны быть отражены в отчёте в виде скриншотов

1. Создать виртуальную машину и установить на неё операционную систему РЕД ОС 7(через любой графический интерфейс)

>[!TIP]
> Либо используя снимки состояния виртуальной машины восстановить её до исходного состояния.

1. Установить на ПК в лаборатории утилиты `WinSCP` и `PuTTY`. Подключиться к Вашей виртуальной машине.

>[!WARNING]
> Последующей действия необходимо выполнять с использованием утилит `WinSCP` и `PuTTY`

2. Используя **dnf** обновить все пакеты. 

>[!IMPORTANT]
> В ряде случаев необходимо прописать в файле `/etc/dnf/dnf.conf` прокси сервер:
> ```bash
> proxy=http://250-prep:3128
>```

3. Установить **mysql** как демон системы. Вывести информацию о состоянии работы демона **mysql**. Создать снимок состояния виртуальной машины.

>[!TIP]
> Установка/Работа с **mysql** производится только с использованием утилит `WinSCP` и `PuTTY`

4. Вывести в терминал временный пароль учётной записи **root** СУБД MySQL, создаваемый при первом запуске. Пароль хранится в файле `/var/log/mysqld.log`

5. Используя терминал Linux(в утилите `PuTTY`) подключится к СУБД MySQL и сменить временный пароль для учетной записи ***root***. Установить следующий пароль - *Root-123*. 

6. Создать базу данных с Вашей фамилией. В БД создать таблицы с именем `usr` и `usr_another`. В таблицах создать первичные ключи с автоинкреметированием. Типы атрибутов и их ограничения выбирать исходя из содержимого файлов.

7. Импортировать в таблицу данные из файлов: `User.csv` в `usr`, с использованием утилиты **mysqlimport**, а `UserAnother.csv` в `usr_another`, с использованием языка SQL. 

8. C помощью **dnf** установить пакет `x11vnc`. Настройте его для удаленного управления. Пакет `x11vnc` должен быть установлен в ОС службой. [Настройка x11vnc](https://redos.red-soft.ru/base/server-configuring/remote-control/x11vnc/)

9. Подключиться с помощью **TightVNC** к созданной Вами виртуальной машине. Сделать снимок состояния виртуальной машины.

10. Вывести UID пользователя. Найти информацию о текущем пользователи в файлах `/etc/passwd`, `/etc/group` и `/etc/shadow`.

10. Написать bash-скрипт выводящий на терминал имена всех пользователей в ОС. Имена пользователей вывести в виде строки с разделителем запятая(`,`).

11. Написать bash-скрипт выводящий на терминал имена групп отсортированных по GID в порядке убывания. Имена групп выводятся построчно.

12. Создать в системе две новые группы для следующих категорий пользователей: клиент - *clients*, менеджер - *managers*.

13. Написать bash скрипт который создает локальных пользователей в системе основываясь на данных из файла `User.csv`. Пользователей распределить по соответствующим группам. Администраторов добавить в стандартную группу *wheel*

13. Написать bash скрипт который создает локальных пользователей в системе основываясь на данных из файла `UserAnother.csv`. Данный скрипт должен создавать только пользователей относящихся к администраторам. Все остальные пользователи из файла должны игнорироваться. Перебор файла должен осуществлять отличным способом от предыдущего задания. Скрипт должен выводить в терминал *Фамилия И.О.* всех записей из файла `UserAnother.csv`. При выводе пользователей относящихся к категории администратор *Фамилия И.О.* должны подкрасится зелёным цветом, все остальные записи подкрасить красным.

14. Используя утилиту `passwd` сменить пароль любому пользователю из списка `User.csv` или `UserAnother.csv`. Войти в систему под этим пользователем.

15. Написать bash скрипт который удаляет локального пользователя системы. Скрипт должен запрашивать у пользователя ввод фамилии той учетной записи, которую необходимо удалить из системы. В случаи обнаружения нескольких пользователей с одинаковой фамилией - запросить уточнение какого именно пользователя удалить. Перед удалением учетной записи необходимо запросить подтверждение действия.

>[!WARNING]
> Последующее задание выполнить с использованием утилиты **TightVNC**

18. Используя утилиту [system-config-users](https://redos.red-soft.ru/base/manual/administration-users/ro73-system-config-users/) создать пользователя с Вашей ФИО. Логин допускается указать на Ваше усмотрение. Войти в систему под созданной учетной записью. Вывести информацию о пользователи.
